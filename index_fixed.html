<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">

  <!-- Admin Panel Modal -->
  <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 id="adminModalTitle" class="text-xl font-bold text-gray-800">Admin Panel</h3>
            <button onclick="closeAdminPanel()" class="text-gray-500 hover:text-gray-700">
              <span class="text-2xl">&times;</span>
            </button>
          </div>

          <!-- ‚úÖ Challenge Form -->
          <form id="challengeForm" class="space-y-4 hidden">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Challenge Name</label>
              <input type="text" id="challengeName" required class="w-full p-3 border rounded-lg">
            </div>
            <div>
              <label class="block text-sm font-medium">Emoji</label>
              <input type="text" id="challengeEmoji" class="w-full p-3 border rounded-lg" placeholder="üíß">
            </div>
            <div>
              <label class="block text-sm font-medium">Duration (days)</label>
              <input type="number" id="challengeDuration" required class="w-full p-3 border rounded-lg" placeholder="30">
            </div>
            <div>
              <label class="block text-sm font-medium">Description</label>
              <textarea id="challengeDescription" class="w-full p-3 border rounded-lg"></textarea>
            </div>
            <div>
              <label class="block text-sm font-medium">Type</label>
              <select id="challengeType" class="w-full p-3 border rounded-lg">
                <option value="free">Free</option>
                <option value="premium">Premium</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium">Completion Points</label>
              <input type="number" id="challengePoints" value="10" class="w-full p-3 border rounded-lg">
            </div>
            <button type="submit" class="w-full custom-red text-white py-3 rounded-lg bg-red-600 hover:bg-red-700 transition-colors">
              Create Challenge
            </button>
          </form>

          <!-- ‚úÖ Event Form -->
          <form id="eventForm" class="space-y-4 hidden">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Event Name</label>
              <input type="text" id="eventName" required class="w-full p-3 border rounded-lg">
            </div>
            <div>
              <label class="block text-sm font-medium">Emoji</label>
              <input type="text" id="eventEmoji" class="w-full p-3 border rounded-lg" placeholder="üßò‚Äç‚ôÄÔ∏è">
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium">Start Date</label>
                <input type="datetime-local" id="eventStartDate" class="w-full p-3 border rounded-lg">
              </div>
              <div>
                <label class="block text-sm font-medium">End Date</label>
                <input type="datetime-local" id="eventEndDate" class="w-full p-3 border rounded-lg">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium">Location</label>
              <input type="text" id="eventLocation" class="w-full p-3 border rounded-lg">
            </div>
            <div>
              <label class="block text-sm font-medium">Event Details</label>
              <textarea id="eventDetails" class="w-full p-3 border rounded-lg"></textarea>
            </div>
            <div>
              <label class="block text-sm font-medium">Completion Points</label>
              <input type="number" id="eventPoints" class="w-full p-3 border rounded-lg">
            </div>
            <div>
              <label class="block text-sm font-medium">Event Images (Max 5)</label>
              <input type="file" id="eventImages" multiple accept="image/*" class="w-full p-3 border rounded-lg">
            </div>
            <button type="submit" class="w-full custom-red text-white py-3 rounded-lg bg-red-600 hover:bg-red-700 transition-colors">
              Create Event
            </button>
          </form>

        </div>
      </div>
    </div>
  </div>

  <script>
    // ‚úÖ Challenge listener
    document.getElementById('challengeForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      try {
        const { error } = await supabase
          .from('challenges')
          .insert([
            {
              name: document.getElementById('challengeName').value,
              emoji: document.getElementById('challengeEmoji').value,
              duration: parseInt(document.getElementById('challengeDuration').value),
              description: document.getElementById('challengeDescription').value,
              type: document.getElementById('challengeType').value,
              completion_points: parseInt(document.getElementById('challengePoints').value) || 10,
              created_by: currentUser.id
            }
          ]);
        if (error) throw error;
        await loadChallenges();
        showToast('Challenge created successfully!');
      } catch (error) {
        console.error("üí• Error creating challenge:", error.message);
        showToast(`Error: ${error.message}`);
      }
    });

    // ‚úÖ Event listener (placeholder - logic event ‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
    document.getElementById('eventForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      try {
        // üëâ logic ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö insert event
      } catch (error) {
        console.error("üí• Error creating event:", error.message);
        showToast(`Error: ${error.message}`);
      }
    });

    function closeAdminPanel() {
      document.getElementById('adminModal').classList.add('hidden');
    }
  </script>
</body>
</html>
